<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>微信消息自动发送系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#7E57C2',
                        secondary: '#EC407A',
                        accent: '#26A69A',
                        neutral: '#263238',
                        "neutral-light": '#ECEFF1',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .scrollbar-hide {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
            .scrollbar-hide::-webkit-scrollbar {
                display: none;
            }
            .card-shadow {
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            }
            .transition-all-300 {
                transition: all 300ms ease-in-out;
            }
        }
    </style>
</head>
<body class="bg-gray-50 text-neutral min-h-screen flex flex-col">
    <!-- 顶部导航栏 -->
    <header class="bg-white shadow-md fixed top-0 left-0 right-0 z-50">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center space-x-2">
                <i class="fa fa-wechat text-primary text-2xl"></i>
                <h1 class="text-xl font-bold text-primary">微信消息自动发送系统</h1>
            </div>
            <div class="flex items-center space-x-6">
                <button id="reload-wx-btn" class="text-gray-600 hover:text-primary transition-all-300 flex items-center">
                    <i class="fa fa-refresh mr-1"></i>
                    <span>刷新微信</span>
                </button>
                <button id="check-update-btn" class="text-gray-600 hover:text-primary transition-all-300 flex items-center">
                    <i class="fa fa-cloud-download mr-1"></i>
                    <span>检查更新</span>
                </button>
                <div class="relative">
                    <button id="user-menu-btn" class="flex items-center space-x-1 focus:outline-none">
                        <img src="https://picsum.photos/id/64/40/40" alt="用户头像" class="w-8 h-8 rounded-full object-cover border-2 border-primary">
                        <span class="hidden md:inline font-medium">用户</span>
                        <i class="fa fa-chevron-down text-xs"></i>
                    </button>
                    <div id="user-menu" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 hidden z-50">
                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">个人中心</a>
                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">会员信息</a>
                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">帮助中心</a>
                        <div class="border-t border-gray-100"></div>
                        <a href="#" class="block px-4 py-2 text-sm text-red-600 hover:bg-gray-100">退出登录</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="flex-grow container mx-auto px-4 pt-20 pb-10">
        <!-- 导航标签 -->
        <div class="border-b border-gray-200 mb-6">
            <ul class="flex flex-wrap -mb-px" id="tabs" role="tablist">
                <li class="mr-2" role="presentation">
                    <button id="home-tab" data-tab="home" class="inline-block p-4 border-b-2 border-primary text-primary rounded-t-lg font-medium" aria-selected="true">
                        <i class="fa fa-home mr-1"></i>主页
                    </button>
                </li>
                <li class="mr-2" role="presentation">
                    <button id="tasks-tab" data-tab="tasks" class="inline-block p-4 border-b-2 border-transparent hover:text-gray-600 hover:border-gray-300 rounded-t-lg font-medium" aria-selected="false">
                        <i class="fa fa-tasks mr-1"></i>任务管理
                    </button>
                </li>
                <li class="mr-2" role="presentation">
                    <button id="ai-tab" data-tab="ai" class="inline-block p-4 border-b-2 border-transparent hover:text-gray-600 hover:border-gray-300 rounded-t-lg font-medium" aria-selected="false">
                        <i class="fa fa-robot mr-1"></i>AI助手
                    </button>
                </li>
                <li class="mr-2" role="presentation">
                    <button id="activities-tab" data-tab="activities" class="inline-block p-4 border-b-2 border-transparent hover:text-gray-600 hover:border-gray-300 rounded-t-lg font-medium" aria-selected="false">
                        <i class="fa fa-history mr-1"></i>活动记录
                    </button>
                </li>
                <li role="presentation">
                    <button id="settings-tab" data-tab="settings" class="inline-block p-4 border-b-2 border-transparent hover:text-gray-600 hover:border-gray-300 rounded-t-lg font-medium" aria-selected="false">
                        <i class="fa fa-cog mr-1"></i>设置
                    </button>
                </li>
            </ul>
        </div>

        <!-- 主页内容 -->
        <div id="home-tab-content" class="tab-content">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- 左侧：任务添加 -->
                <div class="md:col-span-1">
                    <div class="bg-white rounded-xl p-5 card-shadow">
                        <h2 class="text-lg font-bold mb-4 flex items-center">
                            <i class="fa fa-plus-circle text-primary mr-2"></i>添加新任务
                        </h2>
                        <form id="add-task-form" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">接收方</label>
                                <input type="text" id="receiver-input" placeholder="输入联系人或群聊名称" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">消息内容</label>
                                <textarea id="message-input" rows="3" placeholder="输入要发送的消息内容" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary"></textarea>
                                <div class="flex mt-1 space-x-2">
                                    <button type="button" id="add-emotion-btn" class="text-gray-500 hover:text-primary transition-all-300">
                                        <i class="fa fa-smile-o"></i>
                                    </button>
                                    <button type="button" id="add-file-btn" class="text-gray-500 hover:text-primary transition-all-300">
                                        <i class="fa fa-paperclip"></i>
                                    </button>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">发送时间</label>
                                <input type="datetime-local" id="time-input" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">发送频率</label>
                                <select id="frequency-select" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                                    <option value="once">仅一次</option>
                                    <option value="daily">每天</option>
                                    <option value="workdays">工作日</option>
                                    <option value="weekends">周末</option>
                                    <option value="custom">自定义...</option>
                                </select>
                            </div>
                            <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-white py-2 px-4 rounded-lg transition-all-300 font-medium flex items-center justify-center">
                                <i class="fa fa-save mr-2"></i>保存任务
                            </button>
                        </form>
                    </div>
                </div>

                <!-- 右侧：任务列表和状态 -->
                <div class="md:col-span-2 space-y-6">
                    <!-- 任务状态概览 -->
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        <div class="bg-white rounded-xl p-4 card-shadow">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500">待执行任务</p>
                                    <h3 class="text-2xl font-bold text-primary" id="pending-tasks-count">0</h3>
                                </div>
                                <div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center">
                                    <i class="fa fa-clock-o text-primary"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl p-4 card-shadow">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500">今日已完成</p>
                                    <h3 class="text-2xl font-bold text-accent" id="completed-tasks-count">0</h3>
                                </div>
                                <div class="w-10 h-10 rounded-full bg-accent/10 flex items-center justify-center">
                                    <i class="fa fa-check text-accent"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl p-4 card-shadow">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500">执行失败</p>
                                    <h3 class="text-2xl font-bold text-secondary" id="failed-tasks-count">0</h3>
                                </div>
                                <div class="w-10 h-10 rounded-full bg-secondary/10 flex items-center justify-center">
                                    <i class="fa fa-exclamation-triangle text-secondary"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 任务列表 -->
                    <div class="bg-white rounded-xl p-5 card-shadow">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-lg font-bold flex items-center">
                                <i class="fa fa-list-alt text-primary mr-2"></i>待执行任务
                            </h2>
                            <div class="flex space-x-2">
                                <button id="start-all-tasks" class="bg-accent hover:bg-accent/90 text-white py-1 px-3 rounded-lg transition-all-300 text-sm">
                                    <i class="fa fa-play mr-1"></i>开始执行
                                </button>
                                <button id="stop-all-tasks" class="bg-secondary hover:bg-secondary/90 text-white py-1 px-3 rounded-lg transition-all-300 text-sm">
                                    <i class="fa fa-stop mr-1"></i>停止执行
                                </button>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full">
                                <thead>
                                    <tr class="bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        <th class="px-3 py-3 rounded-l-lg">接收方</th>
                                        <th class="px-3 py-3">消息内容</th>
                                        <th class="px-3 py-3">时间</th>
                                        <th class="px-3 py-3">频率</th>
                                        <th class="px-3 py-3 rounded-r-lg">操作</th>
                                    </tr>
                                </thead>
                                <tbody id="pending-tasks-list" class="bg-white divide-y divide-gray-200">
                                    <!-- 任务列表将通过JavaScript动态填充 -->
                                    <tr>
                                        <td colspan="5" class="px-3 py-8 text-center text-gray-500">
                                            <i class="fa fa-calendar-o text-2xl mb-2 block"></i>
                                            暂无待执行任务，请添加新任务
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 任务管理内容 -->
        <div id="tasks-tab-content" class="tab-content hidden">
            <div class="bg-white rounded-xl p-5 card-shadow mb-6">
                <div class="flex flex-wrap justify-between items-center mb-4">
                    <h2 class="text-lg font-bold flex items-center">
                        <i class="fa fa-tasks text-primary mr-2"></i>所有任务管理
                    </h2>
                    <div class="flex space-x-3 mt-2 sm:mt-0">
                        <div class="relative">
                            <input type="text" placeholder="搜索任务..." class="pl-9 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                            <i class="fa fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        </div>
                        <button id="import-tasks-btn" class="bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded-lg transition-all-300 flex items-center">
                            <i class="fa fa-upload mr-2"></i>导入
                        </button>
                        <button id="export-tasks-btn" class="bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded-lg transition-all-300 flex items-center">
                            <i class="fa fa-download mr-2"></i>导出
                        </button>
                    </div>
                </div>

                <div class="mb-4 flex flex-wrap gap-2">
                    <button class="px-3 py-1 bg-primary text-white rounded-full text-sm">全部任务</button>
                    <button class="px-3 py-1 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-full text-sm transition-all-300">待执行</button>
                    <button class="px-3 py-1 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-full text-sm transition-all-300">已完成</button>
                    <button class="px-3 py-1 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-full text-sm transition-all-300">已失败</button>
                    <button class="px-3 py-1 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-full text-sm transition-all-300">一次性</button>
                    <button class="px-3 py-1 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-full text-sm transition-all-300">周期性</button>
                </div>

                <div class="overflow-x-auto">
                    <table class="min-w-full">
                        <thead>
                            <tr class="bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                <th class="px-3 py-3">ID</th>
                                <th class="px-3 py-3">接收方</th>
                                <th class="px-3 py-3">消息内容</th>
                                <th class="px-3 py-3">时间</th>
                                <th class="px-3 py-3">频率</th>
                                <th class="px-3 py-3">状态</th>
                                <th class="px-3 py-3">操作</th>
                            </tr>
                        </thead>
                        <tbody id="all-tasks-list" class="bg-white divide-y divide-gray-200">
                            <!-- 任务列表将通过JavaScript动态填充 -->
                            <tr>
                                <td colspan="7" class="px-3 py-8 text-center text-gray-500">
                                    <i class="fa fa-calendar-o text-2xl mb-2 block"></i>
                                    暂无任务数据
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- AI助手内容 -->
        <div id="ai-tab-content" class="tab-content hidden">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="md:col-span-1">
                    <div class="bg-white rounded-xl p-5 card-shadow">
                        <h2 class="text-lg font-bold mb-4 flex items-center">
                            <i class="fa fa-robot text-primary mr-2"></i>AI接管设置
                        </h2>
                        <form id="ai-settings-form" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">接管对象</label>
                                <input type="text" id="ai-receiver-input" placeholder="输入联系人或群聊名称，多个用;分隔" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                                <div class="mt-1">
                                    <label class="inline-flex items-center">
                                        <input type="checkbox" id="global-takeover" class="form-checkbox text-primary">
                                        <span class="ml-2 text-sm text-gray-600">全局AI接管</span>
                                    </label>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">AI模型</label>
                                <select id="ai-model-select" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                                    <option value="moonshot">月之暗面</option>
                                    <option value="wenxin">文心一言</option>
                                    <option value="xinghuo">星火讯飞</option>
                                    <option value="disabled">禁用模型</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">AI角色设定</label>
                                <textarea id="ai-role-input" rows="3" placeholder="例如：你很温馨，回复简单明了" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary"></textarea>
                            </div>
                            <div>
                                <label class="inline-flex items-center">
                                    <input type="checkbox" id="only-at" class="form-checkbox text-primary">
                                    <span class="ml-2 text-sm text-gray-600">只响应@我的消息</span>
                                </label>
                            </div>
                            <button type="button" id="start-ai-btn" class="w-full bg-primary hover:bg-primary/90 text-white py-2 px-4 rounded-lg transition-all-300 font-medium flex items-center justify-center">
                                <i class="fa fa-play mr-2"></i>开始AI接管
                            </button>
                            <button type="button" id="edit-rules-btn" class="w-full bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded-lg transition-all-300 font-medium flex items-center justify-center">
                                <i class="fa fa-list-alt mr-2"></i>编辑回复规则
                            </button>
                        </form>
                    </div>
                </div>

                <div class="md:col-span-2">
                    <div class="bg-white rounded-xl p-5 card-shadow mb-6">
                        <h2 class="text-lg font-bold mb-4 flex items-center">
                            <i class="fa fa-clock-o text-primary mr-2"></i>接管状态
                        </h2>
                        <div class="flex flex-col items-center justify-center py-10">
                            <div id="takeover-time" class="text-6xl font-bold text-primary mb-4">00:00:00</div>
                            <p id="takeover-status" class="text-gray-500 mb-6">Leaf Ai接管 准备就绪</p>
                            <div class="grid grid-cols-3 gap-6 w-full text-center">
                                <div class="bg-neutral-light rounded-lg p-4">
                                    <p class="text-sm text-gray-500">已处理消息</p>
                                    <p class="text-2xl font-bold text-primary" id="processed-count">0</p>
                                </div>
                                <div class="bg-neutral-light rounded-lg p-4">
                                    <p class="text-sm text-gray-500">AI回复</p>
                                    <p class="text-2xl font-bold text-accent" id="ai-reply-count">0</p>
                                </div>
                                <div class="bg-neutral-light rounded-lg p-4">
                                    <p class="text-sm text-gray-500">规则回复</p>
                                    <p class="text-2xl font-bold text-secondary" id="rule-reply-count">0</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl p-5 card-shadow">
                        <h2 class="text-lg font-bold mb-4 flex items-center">
                            <i class="fa fa-comments text-primary mr-2"></i>消息记录
                        </h2>
                        <div id="message-history" class="max-h-96 overflow-y-auto scrollbar-hide space-y-4">
                            <!-- 消息记录将通过JavaScript动态填充 -->
                            <div class="text-center text-gray-500 py-8">
                                <i class="fa fa-comment-o text-2xl mb-2 block"></i>
                                暂无消息记录
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 活动记录内容 -->
        <div id="activities-tab-content" class="tab-content hidden">
            <div class="bg-white rounded-xl p-5 card-shadow mb-6">
                <div class="flex flex-wrap justify-between items-center mb-4">
                    <h2 class="text-lg font-bold flex items-center">
                        <i class="fa fa-history text-primary mr-2"></i>活动记录
                    </h2>
                    <div class="flex space-x-3 mt-2 sm:mt-0">
                        <div class="relative">
                            <input type="text" placeholder="搜索记录..." class="pl-9 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                            <i class="fa fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        </div>
                        <button id="clear-activities-btn" class="bg-secondary hover:bg-secondary/90 text-white py-2 px-4 rounded-lg transition-all-300 flex items-center">
                            <i class="fa fa-trash mr-2"></i>清空记录
                        </button>
                    </div>
                </div>

                <div class="mb-4 flex flex-wrap gap-2">
                    <button class="px-3 py-1 bg-primary text-white rounded-full text-sm">全部记录</button>
                    <button class="px-3 py-1 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-full text-sm transition-all-300">发送成功</button>
                    <button class="px-3 py-1 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-full text-sm transition-all-300">发送失败</button>
                    <button class="px-3 py-1 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-full text-sm transition-all-300">系统操作</button>
                    <button class="px-3 py-1 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-full text-sm transition-all-300">AI操作</button>
                </div>

                <div class="overflow-x-auto">
                    <table class="min-w-full">
                        <thead>
                            <tr class="bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                <th class="px-3 py-3">时间</th>
                                <th class="px-3 py-3">类型</th>
                                <th class="px-3 py-3">内容</th>
                                <th class="px-3 py-3">状态</th>
                            </tr>
                        </thead>
                        <tbody id="activities-list" class="bg-white divide-y divide-gray-200">
                            <!-- 活动记录将通过JavaScript动态填充 -->
                            <tr>
                                <td colspan="4" class="px-3 py-8 text-center text-gray-500">
                                    <i class="fa fa-history text-2xl mb-2 block"></i>
                                    暂无活动记录
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-5 card-shadow">
                    <h2 class="text-lg font-bold mb-4 flex items-center">
                        <i class="fa fa-bar-chart text-primary mr-2"></i>发送统计
                    </h2>
                    <div class="h-64">
                        <canvas id="send-stats-chart"></canvas>
                    </div>
                </div>

                <div class="bg-white rounded-xl p-5 card-shadow">
                    <h2 class="text-lg font-bold mb-4 flex items-center">
                        <i class="fa fa-pie-chart text-primary mr-2"></i>任务类型分布
                    </h2>
                    <div class="h-64">
                        <canvas id="task-type-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- 设置内容 -->
        <div id="settings-tab-content" class="tab-content hidden">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="md:col-span-2">
                    <div class="bg-white rounded-xl p-5 card-shadow mb-6">
                        <h2 class="text-lg font-bold mb-4 flex items-center">
                            <i class="fa fa-wechat text-primary mr-2"></i>微信设置
                        </h2>
                        <div class="space-y-4">
                            <div class="flex flex-wrap items-center">
                                <label class="block w-full sm:w-32 text-sm font-medium text-gray-700">当前微信</label>
                                <div class="flex-1">
                                    <div id="wechat-instances" class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                        <!-- 微信实例将通过JavaScript动态填充 -->
                                        <div class="bg-neutral-light rounded-lg p-3 flex items-center">
                                            <i class="fa fa-wechat text-green-500 text-xl mr-3"></i>
                                            <div>
                                                <p class="font-medium">当前微信</p>
                                                <p class="text-sm text-gray-500">已连接</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="border-t border-gray-200 pt-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">消息设置</label>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div class="flex items-center">
                                        <label class="inline-flex items-center">
                                            <input type="checkbox" id="error-sound" class="form-checkbox text-primary">
                                            <span class="ml-2 text-sm text-gray-600">发送失败时播放提示音</span>
                                        </label>
                                    </div>
                                    <div class="flex items-center">
                                        <label class="inline-flex items-center">
                                            <input type="checkbox" id="error-email" class="form-checkbox text-primary">
                                            <span class="ml-2 text-sm text-gray-600">发送失败时发送邮件通知</span>
                                        </label>
                                    </div>
                                    <div class="flex items-center">
                                        <label class="inline-flex items-center">
                                            <input type="checkbox" id="net-time" class="form-checkbox text-primary">
                                            <span class="ml-2 text-sm text-gray-600">使用网络时间同步</span>
                                        </label>
                                    </div>
                                    <div class="flex items-center">
                                        <label class="inline-flex items-center">
                                            <input type="checkbox" id="import-filter" class="form-checkbox text-primary">
                                            <span class="ml-2 text-sm text-gray-600">导入时过滤过期任务</span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="border-t border-gray-200 pt-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">时间设置</label>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-xs text-gray-500 mb-1">新增任务时间间隔(分钟)</label>
                                        <input type="number" id="add-timestep" min="1" value="5" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                                    </div>
                                    <div>
                                        <label class="block text-xs text-gray-500 mb-1">AI回复延迟(秒)</label>
                                        <input type="number" id="reply-delay" min="0" value="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                                    </div>
                                    <div>
                                        <label class="block text-xs text-gray-500 mb-1">重复回复间隔(分钟)</label>
                                        <input type="number" id="same-reply" min="1" value="5" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl p-5 card-shadow">
                        <h2 class="text-lg font-bold mb-4 flex items-center">
                            <i class="fa fa-envelope text-primary mr-2"></i>邮件设置
                        </h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">接收通知邮箱</label>
                                <input type="email" id="email" placeholder="your@email.com" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">SMTP服务器</label>
                                <input type="text" id="smtp-server" placeholder="smtp.example.com" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">SMTP端口</label>
                                    <input type="number" id="smtp-port" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">邮箱账号</label>
                                    <input type="text" id="email-username" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">邮箱密码/授权码</label>
                                <input type="password" id="email-password" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                            </div>
                            <button id="test-email-btn" class="bg-primary hover:bg-primary/90 text-white py-2 px-4 rounded-lg transition-all-300 font-medium">
                                <i class="fa fa-paper-plane mr-2"></i>测试邮件发送
                            </button>
                        </div>
                    </div>
                </div>

                <div class="md:col-span-1">
                    <div class="bg-white rounded-xl p-5 card-shadow mb-6">
                        <h2 class="text-lg font-bold mb-4 flex items-center">
                            <i class="fa fa-user-circle text-primary mr-2"></i>账户信息
                        </h2>
                        <div class="text-center mb-4">
                            <img src="https://picsum.photos/id/64/100/100" alt="用户头像" class="w-24 h-24 rounded-full object-cover border-4 border-primary mx-auto mb-3">
                            <h3 class="font-bold text-lg">用户名</h3>
                            <p class="text-sm text-gray-500">普通会员</p>
                        </div>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between py-1 border-b border-gray-100">
                                <span class="text-gray-500">会员等级</span>
                                <span class="font-medium">Free</span>
                            </div>
                            <div class="flex justify-between py-1 border-b border-gray-100">
                                <span class="text-gray-500">任务数量限制</span>
                                <span class="font-medium">5个</span>
                            </div>
                            <div class="flex justify-between py-1 border-b border-gray-100">
                                <span class="text-gray-500">AI接管时长</span>
                                <span class="font-medium">60分钟/天</span>
                            </div>
                            <div class="flex justify-between py-1 border-b border-gray-100">
                                <span class="text-gray-500">到期时间</span>
                                <span class="font-medium">永久免费</span>
                            </div>
                        </div>
                        <button class="w-full mt-4 bg-secondary hover:bg-secondary/90 text-white py-2 px-4 rounded-lg transition-all-300 font-medium">
                            <i class="fa fa-rocket mr-2"></i>升级会员
                        </button>
                    </div>

                    <div class="bg-white rounded-xl p-5 card-shadow">
                        <h2 class="text-lg font-bold mb-4 flex items-center">
                            <i class="fa fa-info-circle text-primary mr-2"></i>关于系统
                        </h2>
                        <div class="space-y-3 text-sm">
                            <div>
                                <p class="text-gray-500">系统版本</p>
                                <p class="font-medium">v1.0.0</p>
                            </div>
                            <div>
                                <p class="text-gray-500">微信接口版本</p>
                                <p class="font-medium">wxautox v1.0</p>
                            </div>
                            <div>
                                <p class="text-gray-500">更新日期</p>
                                <p class="font-medium">2023-07-01</p>
                            </div>
                            <div class="pt-2">
                                <button id="check-version-btn" class="w-full text-primary hover:text-primary/80 py-2 border border-primary rounded-lg transition-all-300 font-medium">
                                    <i class="fa fa-refresh mr-2"></i>检查新版本
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="bg-white border-t border-gray-200 py-4">
        <div class="container mx-auto px-4 text-center text-gray-500 text-sm">
            <p>微信消息自动发送系统 &copy; 2023 版权所有</p>
        </div>
    </footer>

    <!-- 模态框：编辑任务 -->
    <div id="edit-task-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-6 w-full max-w-lg mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold text-gray-800">编辑任务</h3>
                <button id="close-edit-modal" class="text-gray-400 hover:text-gray-600">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <form id="edit-task-form" class="space-y-4">
                <input type="hidden" id="edit-task-id">
                <!-- 表单内容与添加任务类似 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">接收方</label>
                    <input type="text" id="edit-receiver-input" placeholder="输入联系人或群聊名称" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">消息内容</label>
                    <textarea id="edit-message-input" rows="3" placeholder="输入要发送的消息内容" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">发送时间</label>
                    <input type="datetime-local" id="edit-time-input" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">发送频率</label>
                    <select id="edit-frequency-select" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                        <option value="once">仅一次</option>
                        <option value="daily">每天</option>
                        <option value="workdays">工作日</option>
                        <option value="weekends">周末</option>
                        <option value="custom">自定义...</option>
                    </select>
                </div>
                <div class="flex justify-end space-x-3 pt-2">
                    <button type="button" id="cancel-edit-task" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-all-300">取消</button>
                    <button type="submit" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-all-300">保存修改</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 模态框：编辑回复规则 -->
    <div id="edit-rules-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-6 w-full max-w-4xl mx-4 max-h-[90vh] overflow-hidden flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold text-gray-800">编辑AI接管规则</h3>
                <button id="close-rules-modal" class="text-gray-400 hover:text-gray-600">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="flex-grow overflow-y-auto">
                <form id="rule-form" class="space-y-4 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">关键词</label>
                            <input type="text" id="keyword-input" placeholder="触发关键词" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">匹配类型</label>
                            <select id="match-type-select" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                                <option value="包含">包含</option>
                                <option value="等于">等于</option>
                                <option value="正则">正则</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">回复内容</label>
                            <input type="text" id="reply-content-input" placeholder="回复内容" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">应用于</label>
                            <input type="text" id="apply-to-input" placeholder="全部" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                        </div>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" id="add-emotion-rule-btn" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-all-300 flex items-center">
                            <i class="fa fa-smile-o mr-2"></i>添加表情
                        </button>
                        <button type="button" id="add-file-rule-btn" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-all-300 flex items-center">
                            <i class="fa fa-paperclip mr-2"></i>添加文件
                        </button>
                        <button type="submit" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-all-300 flex items-center">
                            <i class="fa fa-plus mr-2"></i>添加规则
                        </button>
                    </div>
                </form>

                <div class="border-t border-gray-200 pt-4">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="font-medium">已添加规则</h4>
                        <div class="flex space-x-2">
                            <button id="import-rules-btn" class="text-sm text-primary hover:text-primary/80 transition-all-300 flex items-center">
                                <i class="fa fa-upload mr-1"></i>导入规则
                            </button>
                            <button id="export-rules-btn" class="text-sm text-primary hover:text-primary/80 transition-all-300 flex items-center">
                                <i class="fa fa-download mr-1"></i>导出规则
                            </button>
                        </div>
                    </div>
                    <div id="rules-list" class="space-y-2 max-h-[50vh] overflow-y-auto">
                        <!-- 规则列表将通过JavaScript动态填充 -->
                        <div class="text-center text-gray-500 py-8">
                            <i class="fa fa-list-alt text-2xl mb-2 block"></i>
                            暂无规则，请添加规则
                        </div>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-200 mt-4 pt-4 flex justify-end">
                <button id="save-rules-btn" class="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-all-300">
                    保存规则
                </button>
            </div>
        </div>
    </div>

    <!-- 通知提示 -->
    <div id="notification" class="fixed bottom-4 right-4 bg-white rounded-lg shadow-lg p-4 transform translate-y-20 opacity-0 transition-all-300 max-w-sm z-50 hidden">
        <div class="flex items-start">
            <div id="notification-icon" class="mr-3 text-green-500">
                <i class="fa fa-check-circle text-xl"></i>
            </div>
            <div class="flex-1">
                <h4 id="notification-title" class="font-bold text-gray-800"></h4>
                <p id="notification-message" class="text-sm text-gray-600 mt-1"></p>
            </div>
            <button id="close-notification" class="text-gray-400 hover:text-gray-600 ml-2">
                <i class="fa fa-times"></i>
            </button>
        </div>
    </div>

    <script>
        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化日期时间选择器为当前时间加5分钟
            const now = new Date();
            now.setMinutes(now.getMinutes() + 5);
            const formattedDateTime = now.toISOString().slice(0, 16);
            document.getElementById('time-input').value = formattedDateTime;

            // 标签切换功能
            const tabs = document.querySelectorAll('#tabs button');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // 移除所有标签的活跃状态
                    tabs.forEach(t => {
                        t.classList.remove('border-primary', 'text-primary');
                        t.classList.add('border-transparent', 'hover:text-gray-600', 'hover:border-gray-300');
                        t.setAttribute('aria-selected', 'false');
                    });

                    // 设置当前标签为活跃状态
                    tab.classList.remove('border-transparent', 'hover:text-gray-600', 'hover:border-gray-300');
                    tab.classList.add('border-primary', 'text-primary');
                    tab.setAttribute('aria-selected', 'true');

                    // 隐藏所有内容
                    const tabContents = document.querySelectorAll('.tab-content');
                    tabContents.forEach(content => {
                        content.classList.add('hidden');
                    });

                    // 显示当前标签对应的内容
                    const tabId = tab.getAttribute('data-tab');
                    document.getElementById(`${tabId}-tab-content`).classList.remove('hidden');
                });
            });

            // 用户菜单切换
            const userMenuBtn = document.getElementById('user-menu-btn');
            const userMenu = document.getElementById('user-menu');
            userMenuBtn.addEventListener('click', () => {
                userMenu.classList.toggle('hidden');
            });

            // 点击其他区域关闭用户菜单
            document.addEventListener('click', (e) => {
                if (!userMenuBtn.contains(e.target) && !userMenu.contains(e.target)) {
                    userMenu.classList.add('hidden');
                }
            });

            // 显示通知
            function showNotification(title, message, type = 'success') {
                const notification = document.getElementById('notification');
                const notificationTitle = document.getElementById('notification-title');
                const notificationMessage = document.getElementById('notification-message');
                const notificationIcon = document.getElementById('notification-icon');

                notificationTitle.textContent = title;
                notificationMessage.textContent = message;

                // 设置图标和颜色
                notificationIcon.className = '';
                if (type === 'success') {
                    notificationIcon.className = 'mr-3 text-green-500';
                    notificationIcon.innerHTML = '<i class="fa fa-check-circle text-xl"></i>';
                } else if (type === 'error') {
                    notificationIcon.className = 'mr-3 text-red-500';
                    notificationIcon.innerHTML = '<i class="fa fa-exclamation-circle text-xl"></i>';
                } else if (type === 'warning') {
                    notificationIcon.className = 'mr-3 text-yellow-500';
                    notificationIcon.innerHTML = '<i class="fa fa-exclamation-triangle text-xl"></i>';
                } else if (type === 'info') {
                    notificationIcon.className = 'mr-3 text-blue-500';
                    notificationIcon.innerHTML = '<i class="fa fa-info-circle text-xl"></i>';
                }

                // 显示通知
                notification.classList.remove('hidden', 'translate-y-20', 'opacity-0');
                notification.classList.add('translate-y-0', 'opacity-100');

                // 3秒后自动关闭
                setTimeout(() => {
                    closeNotification();
                }, 3000);
            }

            // 关闭通知
            function closeNotification() {
                const notification = document.getElementById('notification');
                notification.classList.remove('translate-y-0', 'opacity-100');
                notification.classList.add('translate-y-20', 'opacity-0');

                setTimeout(() => {
                    notification.classList.add('hidden');
                }, 300);
            }

            document.getElementById('close-notification').addEventListener('click', closeNotification);

            // 添加任务表单提交
            document.getElementById('add-task-form').addEventListener('submit', function(e) {
                e.preventDefault();

                // 获取表单数据
                const receiver = document.getElementById('receiver-input').value;
                const message = document.getElementById('message-input').value;
                const time = document.getElementById('time-input').value;
                const frequency = document.getElementById('frequency-select').value;

                // 简单验证
                if (!receiver || !message || !time) {
                    showNotification('输入不完整', '请填写所有必填字段', 'error');
                    return;
                }


                // 模拟API请求
                fetch('/api/add_task', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        receiver: receiver,
                        message: message,
                        time: time,
                        frequency: frequency
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        showNotification('任务添加成功', '新任务已成功添加到任务列表');
                        // 重置表单
                        document.getElementById('receiver-input').value = '';
                        document.getElementById('message-input').value = '';
                        // 更新任务列表
                        loadTasks();
                    } else {
                        showNotification('添加失败', data.message || '添加任务时发生错误', 'error');
                    }
                })
                .catch(error => {
                    showNotification('网络错误', '无法连接到服务器', 'error');
                    console.error('Error:', error);
                });
            });

            // 刷新微信按钮
            document.getElementById('reload-wx-btn').addEventListener('click', function() {
                fetch('/api/reload_wx', {
                    method: 'POST'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        showNotification('刷新成功', data.message || '微信已成功刷新');
                        // 更新微信实例列表
                        loadWechatInstances();
                    } else {
                        showNotification('刷新失败', data.message || '刷新微信时发生错误', 'error');
                    }
                })
                .catch(error => {
                    showNotification('网络错误', '无法连接到服务器', 'error');
                    console.error('Error:', error);
                });
            });

            // 开始/停止所有任务按钮
            document.getElementById('start-all-tasks').addEventListener('click', function() {
                fetch('/api/start_task', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ all: true })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        showNotification('任务已启动', '所有任务已开始执行');
                    } else {
                        showNotification('启动失败', data.message || '启动任务时发生错误', 'error');
                    }
                })
                .catch(error => {
                    showNotification('网络错误', '无法连接到服务器', 'error');
                    console.error('Error:', error);
                });
            });

            document.getElementById('stop-all-tasks').addEventListener('click', function() {
                fetch('/api/stop_task', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ all: true })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        showNotification('任务已停止', '所有任务已停止执行');
                    } else {
                        showNotification('停止失败', data.message || '停止任务时发生错误', 'error');
                    }
                })
                .catch(error => {
                    showNotification('网络错误', '无法连接到服务器', 'error');
                    console.error('Error:', error);
                });
            });

            // 编辑回复规则按钮
            document.getElementById('edit-rules-btn').addEventListener('click', function() {
                document.getElementById('edit-rules-modal').classList.remove('hidden');
                // 加载现有规则
                loadRules();
            });

            // 关闭规则编辑模态框
            document.getElementById('close-rules-modal').addEventListener('click', function() {
                document.getElementById('edit-rules-modal').classList.add('hidden');
            });

            // 保存规则按钮
            document.getElementById('save-rules-btn').addEventListener('click', function() {
                // 模拟保存规则
                showNotification('规则已保存', '自动回复规则已更新');
                document.getElementById('edit-rules-modal').classList.add('hidden');
            });

            // 检查更新按钮
            document.getElementById('check-update-btn').addEventListener('click', function() {
                fetch('/api/check_update')
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        if (data.is_latest) {
                            showNotification('已是最新版本', '当前已是最新版本，无需更新');
                        } else {
                            showNotification('发现新版本', `发现新版本 ${data.latest_version}，请更新`, 'info');
                        }
                    } else {
                        showNotification('检查失败', data.message || '检查更新时发生错误', 'error');
                    }
                })
                .catch(error => {
                    showNotification('网络错误', '无法连接到服务器', 'error');
                    console.error('Error:', error);
                });
            });

            // 初始化图表
            function initCharts() {
                // 发送统计图表
                const sendStatsCtx = document.getElementById('send-stats-chart').getContext('2d');
                new Chart(sendStatsCtx, {
                    type: 'bar',
                    data: {
                        labels: ['周一', '周二', '周三', '周四', '周五', '周六', '周日'],
                        datasets: [{
                            label: '成功发送',
                            data: [12, 19, 8, 15, 20, 5, 7],
                            backgroundColor: 'rgba(38, 166, 154, 0.7)',
                        }, {
                            label: '发送失败',
                            data: [2, 3, 1, 4, 2, 0, 1],
                            backgroundColor: 'rgba(236, 64, 122, 0.7)',
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });

                // 任务类型分布图表
                const taskTypeCtx = document.getElementById('task-type-chart').getContext('2d');
                new Chart(taskTypeCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['仅一次', '每天', '工作日', '周末', '自定义'],
                        datasets: [{
                            data: [35, 25, 20, 10, 10],
                            backgroundColor: [
                                'rgba(126, 87, 194, 0.7)',
                                'rgba(38, 166, 154, 0.7)',
                                'rgba(33, 150, 243, 0.7)',
                                'rgba(255, 152, 0, 0.7)',
                                'rgba(156, 39, 176, 0.7)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right'
                            }
                        }
                    }
                });
            }

            // 加载任务列表
            function loadTasks() {
                fetch('/api/get_tasks')
                .then(response => response.json())
                .then(tasks => {
                    const pendingTasksList = document.getElementById('pending-tasks-list');
                    const allTasksList = document.getElementById('all-tasks-list');
                    const pendingTasksCount = document.getElementById('pending-tasks-count');

                    // 清空现有列表
                    pendingTasksList.innerHTML = '';
                    allTasksList.innerHTML = '';

                    if (tasks.length === 0) {
                        pendingTasksList.innerHTML = `
                            <tr>
                                <td colspan="5" class="px-3 py-8 text-center text-gray-500">
                                    <i class="fa fa-calendar-o text-2xl mb-2 block"></i>
                                    暂无待执行任务，请添加新任务
                                </td>
                            </tr>
                        `;
                        allTasksList.innerHTML = `
                            <tr>
                                <td colspan="7" class="px-3 py-8 text-center text-gray-500">
                                    <i class="fa fa-calendar-o text-2xl mb-2 block"></i>
                                    暂无任务数据
                                </td>
                            </tr>
                        `;
                        pendingTasksCount.textContent = '0';
                        return;
                    }

                    // 更新任务计数
                    pendingTasksCount.textContent = tasks.length;

                    // 填充待执行任务列表
                    tasks.forEach(task => {
                        // 格式化时间
                        const formattedTime = new Date(task.time).toLocaleString();

                        // 转换频率文本
                        let frequencyText = '仅一次';
                        if (task.frequency === 'daily') frequencyText = '每天';
                        else if (task.frequency === 'workdays') frequencyText = '工作日';
                        else if (task.frequency === 'weekends') frequencyText = '周末';
                        else if (task.frequency === 'custom') frequencyText = '自定义';

                        // 添加到待执行任务列表
                        const pendingRow = document.createElement('tr');
                        pendingRow.innerHTML = `
                            <td class="px-3 py-4 whitespace-nowrap">${task.receiver}</td>
                            <td class="px-3 py-4 max-w-xs truncate">${task.message}</td>
                            <td class="px-3 py-4 whitespace-nowrap">${formattedTime}</td>
                            <td class="px-3 py-4 whitespace-nowrap">${frequencyText}</td>
                            <td class="px-3 py-4 whitespace-nowrap">
                                <div class="flex space-x-2">
                                    <button class="edit-task-btn text-blue-600 hover:text-blue-800" data-id="${task.id}">
                                        <i class="fa fa-pencil"></i>
                                    </button>
                                    <button class="delete-task-btn text-red-600 hover:text-red-800" data-id="${task.id}">
                                        <i class="fa fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        `;
                        pendingTasksList.appendChild(pendingRow);

                        // 添加到所有任务列表
                        const allRow = document.createElement('tr');
                        allRow.innerHTML = `
                            <td class="px-3 py-4 whitespace-nowrap">${task.id}</td>
                            <td class="px-3 py-4 whitespace-nowrap">${task.receiver}</td>
                            <td class="px-3 py-4 max-w-xs truncate">${task.message}</td>
                            <td class="px-3 py-4 whitespace-nowrap">${formattedTime}</td>
                            <td class="px-3 py-4 whitespace-nowrap">${frequencyText}</td>
                            <td class="px-3 py-4 whitespace-nowrap">
                                <span class="px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800">
                                    待执行
                                </span>
                            </td>
                            <td class="px-3 py-4 whitespace-nowrap">
                                <div class="flex space-x-2">
                                    <button class="edit-task-btn text-blue-600 hover:text-blue-800" data-id="${task.id}">
                                        <i class="fa fa-pencil"></i>
                                    </button>
                                    <button class="delete-task-btn text-red-600 hover:text-red-800" data-id="${task.id}">
                                        <i class="fa fa-trash"></i>
                                    </button>
                                    <button class="start-task-btn text-green-600 hover:text-green-800" data-id="${task.id}">
                                        <i class="fa fa-play"></i>
                                    </button>
                                </div>
                            </td>
                        `;
                        allTasksList.appendChild(allRow);
                    });

                    // 添加事件监听器
                    document.querySelectorAll('.edit-task-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const taskId = this.getAttribute('data-id');
                            openEditTaskModal(taskId);
                        });
                    });

                    document.querySelectorAll('.delete-task-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const taskId = this.getAttribute('data-id');
                            if (confirm('确定要删除这个任务吗？')) {
                                deleteTask(taskId);
                            }
                        });
                    });

                    document.querySelectorAll('.start-task-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const taskId = this.getAttribute('data-id');
                            startTask(taskId);
                        });
                    });
                })
                .catch(error => {
                    console.error('Error loading tasks:', error);
                });
            }

            // 打开编辑任务模态框
            function openEditTaskModal(taskId) {
                // 这里应该从API获取任务详情
                // 模拟获取任务详情
                const task = {
                    id: taskId,
                    receiver: '测试联系人',
                    message: '这是一条测试消息',
                    time: new Date().toISOString().slice(0, 16),
                    frequency: 'once'
                };

                // 填充表单
                document.getElementById('edit-task-id').value = task.id;
                document.getElementById('edit-receiver-input').value = task.receiver;
                document.getElementById('edit-message-input').value = task.message;
                document.getElementById('edit-time-input').value = task.time;
                document.getElementById('edit-frequency-select').value = task.frequency;

                // 显示模态框
                document.getElementById('edit-task-modal').classList.remove('hidden');
            }

            // 关闭编辑任务模态框
            document.getElementById('close-edit-modal').addEventListener('click', function() {
                document.getElementById('edit-task-modal').classList.add('hidden');
            });

            document.getElementById('cancel-edit-task').addEventListener('click', function() {
                document.getElementById('edit-task-modal').classList.add('hidden');
            });

            // 编辑任务表单提交
            document.getElementById('edit-task-form').addEventListener('submit', function(e) {
                e.preventDefault();

                // 获取表单数据
                const taskId = document.getElementById('edit-task-id').value;
                const receiver = document.getElementById('edit-receiver-input').value;
                const message = document.getElementById('edit-message-input').value;
                const time = document.getElementById('edit-time-input').value;
                const frequency = document.getElementById('edit-frequency-select').value;

                // 简单验证
                if (!receiver || !message || !time) {
                    showNotification('输入不完整', '请填写所有必填字段', 'error');
                    return;
                }

                // 模拟API请求
                fetch('/api/update_task', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        id: taskId,
                        receiver: receiver,
                        message: message,
                        time: time,
                        frequency: frequency
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        showNotification('任务更新成功', '任务已成功更新');
                        // 关闭模态框
                        document.getElementById('edit-task-modal').classList.add('hidden');
                        // 更新任务列表
                        loadTasks();
                    } else {
                        showNotification('更新失败', data.message || '更新任务时发生错误', 'error');
                    }
                })
                .catch(error => {
                    showNotification('网络错误', '无法连接到服务器', 'error');
                    console.error('Error:', error);
                });
            });

            // 删除任务
            function deleteTask(taskId) {
                fetch('/api/remove_task', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ id: taskId })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        showNotification('任务已删除', '任务已成功从列表中删除');
                        // 更新任务列表
                        loadTasks();
                    } else {
                        showNotification('删除失败', data.message || '删除任务时发生错误', 'error');
                    }
                })
                .catch(error => {
                    showNotification('网络错误', '无法连接到服务器', 'error');
                    console.error('Error:', error);
                });
            }

            // 开始任务
            function startTask(taskId) {
                fetch('/api/start_task', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ id: taskId })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        showNotification('任务已启动', '任务已开始执行');
                    } else {
                        showNotification('启动失败', data.message || '启动任务时发生错误', 'error');
                    }
                })
                .catch(error => {
                    showNotification('网络错误', '无法连接到服务器', 'error');
                    console.error('Error:', error);
                });
            }

            // 加载微信实例
            function loadWechatInstances() {
                // 模拟数据
                const instances = [
                    { name: '当前微信', status: '已连接' }
                ];

                const wechatInstances = document.getElementById('wechat-instances');
                wechatInstances.innerHTML = '';

                // 填充微信实例
                instances.forEach(instance => {
                    const instanceDiv = document.createElement('div');
                    instanceDiv.className = 'bg-neutral-light rounded-lg p-3 flex items-center';
                    instanceDiv.innerHTML = `
                        <i class="fa fa-wechat text-green-500 text-xl mr-3"></i>
                        <div>
                            <p class="font-medium">${instance.name}</p>
                            <p class="text-sm text-gray-500">${instance.status}</p>
                        </div>
                    `;
                    wechatInstances.appendChild(instanceDiv);
                });
            }

            // 加载规则
            function loadRules() {
                // 模拟数据
                const rules = [
                    { keyword: '你好', match_type: '包含', reply_content: '你好！有什么可以帮助你的吗？', apply_to: '全部' },
                    { keyword: '再见', match_type: '包含', reply_content: '再见！祝你有愉快的一天！', apply_to: '全部' },
                    { keyword: '价格', match_type: '包含', reply_content: '我们的产品价格是99元', apply_to: '客户群' }
                ];

                const rulesList = document.getElementById('rules-list');
                rulesList.innerHTML = '';

                if (rules.length === 0) {
                    rulesList.innerHTML = `
                        <div class="text-center text-gray-500 py-8">
                            <i class="fa fa-list-alt text-2xl mb-2 block"></i>
                            暂无规则，请添加规则
                        </div>
                    `;
                    return;
                }

                rules.forEach(rule => {
                    const ruleDiv = document.createElement('div');
                    ruleDiv.className = 'bg-neutral-light rounded-lg p-3 flex items-center justify-between';

                    let matchTypeClass = '';
                    if (rule.match_type === '包含') matchTypeClass = 'bg-green-100 text-green-800';
                    else if (rule.match_type === '等于') matchTypeClass = 'bg-blue-100 text-blue-800';
                    else if (rule.match_type === '正则') matchTypeClass = 'bg-purple-100 text-purple-800';

                    ruleDiv.innerHTML = `
                        <div class="flex items-center space-x-3 flex-1 min-w-0">
                            <span class="font-medium text-primary truncate">${rule.keyword}</span>
                            <span class="px-2 py-0.5 text-xs rounded-full ${matchTypeClass}">${rule.match_type}</span>
                            <span class="text-sm text-gray-600 truncate">${rule.reply_content}</span>
                            <span class="px-2 py-0.5 text-xs rounded-full bg-orange-100 text-orange-800">${rule.apply_to}</span>
                        </div>
                        <button class="delete-rule-btn text-red-500 hover:text-red-700 ml-2">
                            <i class="fa fa-times"></i>
                        </button>
                    `;
                    rulesList.appendChild(ruleDiv);

                    // 添加删除事件
                    ruleDiv.querySelector('.delete-rule-btn').addEventListener('click', function() {
                        ruleDiv.remove();
                        if (rulesList.children.length === 0) {
                            rulesList.innerHTML = `
                                <div class="text-center text-gray-500 py-8">
                                    <i class="fa fa-list-alt text-2xl mb-2 block"></i>
                                    暂无规则，请添加规则
                                </div>
                            `;
                        }
                    });
                });
            }

            // 添加规则表单提交
            document.getElementById('rule-form').addEventListener('submit', function(e) {
                e.preventDefault();

                const keyword = document.getElementById('keyword-input').value;
                const matchType = document.getElementById('match-type-select').value;
                const replyContent = document.getElementById('reply-content-input').value;
                const applyTo = document.getElementById('apply-to-input').value || '全部';

                if (!keyword || !replyContent) {
                    showNotification('输入不完整', '关键词和回复内容为必填项', 'error');
                    return;
                }

                const rulesList = document.getElementById('rules-list');

                // 清除空状态提示
                if (rulesList.querySelector('.text-center')) {
                    rulesList.innerHTML = '';
                }

                // 创建新规则元素
                let matchTypeClass = '';
                if (matchType === '包含') matchTypeClass = 'bg-green-100 text-green-800';
                else if (matchType === '等于') matchTypeClass = 'bg-blue-100 text-blue-800';
                else if (matchType === '正则') matchTypeClass = 'bg-purple-100 text-purple-800';

                const ruleDiv = document.createElement('div');
                ruleDiv.className = 'bg-neutral-light rounded-lg p-3 flex items-center justify-between';
                ruleDiv.innerHTML = `
                    <div class="flex items-center space-x-3 flex-1 min-w-0">
                        <span class="font-medium text-primary truncate">${keyword}</span>
                        <span class="px-2 py-0.5 text-xs rounded-full ${matchTypeClass}">${matchType}</span>
                        <span class="text-sm text-gray-600 truncate">${replyContent}</span>
                        <span class="px-2 py-0.5 text-xs rounded-full bg-orange-100 text-orange-800">${applyTo}</span>
                    </div>
                    <button class="delete-rule-btn text-red-500 hover:text-red-700 ml-2">
                        <i class="fa fa-times"></i>
                    </button>
                `;
                rulesList.appendChild(ruleDiv);

                // 添加删除事件
                ruleDiv.querySelector('.delete-rule-btn').addEventListener('click', function() {
                    ruleDiv.remove();
                    if (rulesList.children.length === 0) {
                        rulesList.innerHTML = `
                            <div class="text-center text-gray-500 py-8">
                                <i class="fa fa-list-alt text-2xl mb-2 block"></i>
                                暂无规则，请添加规则
                            </div>
                        `;
                    }
                });

                // 重置表单
                document.getElementById('keyword-input').value = '';
                document.getElementById('reply-content-input').value = '';
                document.getElementById('apply-to-input').value = '';
            });

            // 开始AI接管
            document.getElementById('start-ai-btn').addEventListener('click', function() {
                const btn = this;
                const isRunning = btn.innerHTML.includes('停止AI接管');

                if (isRunning) {
                    // 停止AI接管
                    btn.innerHTML = '<i class="fa fa-play mr-2"></i>开始AI接管';
                    btn.classList.remove('bg-secondary', 'hover:bg-secondary/90');
                    btn.classList.add('bg-primary', 'hover:bg-primary/90');
                    document.getElementById('takeover-status').textContent = 'Leaf Ai接管 准备就绪';
                    showNotification('AI接管已停止', '已停止AI自动回复功能');
                } else {
                    // 开始AI接管
                    const receiver = document.getElementById('ai-receiver-input').value;

                    if (!receiver && !document.getElementById('global-takeover').checked) {
                        showNotification('设置不完整', '请选择接管对象或启用全局接管', 'error');
                        return;
                    }

                    btn.innerHTML = '<i class="fa fa-stop mr-2"></i>停止AI接管';
                    btn.classList.remove('bg-primary', 'hover:bg-primary/90');
                    btn.classList.add('bg-secondary', 'hover:bg-secondary/90');
                    document.getElementById('takeover-status').textContent = 'Leaf Ai 已为您接管';
                    showNotification('AI接管已启动', 'AI自动回复功能已开始运行');

                    // 开始计时
                    let seconds = 0;
                    const timerElement = document.getElementById('takeover-time');
                    const timer = setInterval(() => {
                        seconds++;
                        const hours = Math.floor(seconds / 3600).toString().padStart(2, '0');
                        const minutes = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0');
                        const secs = (seconds % 60).toString().padStart(2, '0');
                        timerElement.textContent = `${hours}:${minutes}:${secs}`;

                        // 如果按钮已切换回开始状态，则停止计时器
                        if (btn.innerHTML.includes('开始AI接管')) {
                            clearInterval(timer);
                        }
                    }, 1000);
                }
            });

            // 全局AI接管复选框
            document.getElementById('global-takeover').addEventListener('change', function() {
                const receiverInput = document.getElementById('ai-receiver-input');
                if (this.checked) {
                    receiverInput.value = '全局AI接管';
                    receiverInput.disabled = true;
                } else {
                    receiverInput.value = '';
                    receiverInput.disabled = false;
                }
            });

            // 初始化页面数据
            loadWechatInstances();
            loadTasks();
            initCharts();

            // 显示欢迎通知
            setTimeout(() => {
                showNotification('欢迎使用', '微信消息自动发送系统已准备就绪');
            }, 1000);
        });
    </script>
</body>
</html>
