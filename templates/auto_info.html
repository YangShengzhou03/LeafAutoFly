{% extends 'base.html' %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/auto_info.css') }}">
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/auto_info.js') }}"></script>
{% endblock %}

{% block content %}
    <div class="page-header">
        <h1>LeafAuto Info</h1>
    </div>
    <div class="auto-info-container">
        <!-- 主内容区 -->
        <main class="main-content">
            <!-- 通知提示区域 -->
            <div class="notification-container" id="notificationContainer"></div>

            <!-- 任务创建卡片 -->
            <div class="task-creation-card animate-fade-in">
                <div class="card-header">
                    <h2 class="card-title">
                        <span class="plus-icon"></span>创建新任务
                    </h2>
                    <p class="card-subtitle">设置自动发送的信息内容、接收者和发送时间</p>
                </div>
                <div class="card-body">
                    <form id="taskForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="recipient" class="form-label">
                                    接收者 <span class="required">*</span> <span class="field-hint">多个接收者用逗号分隔</span>
                                </label>
                                <div class="recipient-input-wrapper">
                                    <input type="text" id="recipient" name="recipient" class="form-control" placeholder="输入接收者信息" required>
                                    <span class="contact-icon"></span>
                                </div>
                                <div class="error-message" id="recipientError"></div>
                            </div>

                            <div class="form-group time-setting">
                                <label for="sendTime" class="form-label">
                                    发送时间 <span class="required">*</span>
                                </label>
                                <input type="datetime-local" id="sendTime" name="sendTime" class="form-control" required>
                                <div class="error-message" id="sendTimeError"></div>
                            </div>

                            <div class="form-group repeat-setting">
                                <label class="form-label">
                                    重复选项
                                </label>
                                <div class="repeat-dropdown">
                                    <button type="button" class="repeat-btn" id="repeatBtn">
                                        不重复 <span class="dropdown-icon"></span>
                                    </button>
                                    <div class="repeat-options" id="repeatOptions" style="display: none;">
                                        <div class="repeat-option" data-repeat="none">不重复</div>
                                        <div class="repeat-option" data-repeat="daily">每天</div>
                                        <div class="repeat-option" data-repeat="workday">法定工作日</div>
                                        <div class="repeat-option" data-repeat="holiday">法定节假日</div>
                                        <div class="repeat-option" data-repeat="custom">自定义...</div>
                                        <div class="custom-days" id="customDays">
                                            <p class="form-text mb-2">选择重复日期：</p>
                                            <div class="day-selector">
                                                <label><input type="checkbox" name="repeatDays" value="1"> <span>周一</span></label>
                                                <label><input type="checkbox" name="repeatDays" value="2"> <span>周二</span></label>
                                                <label><input type="checkbox" name="repeatDays" value="3"> <span>周三</span></label>
                                                <label><input type="checkbox" name="repeatDays" value="4"> <span>周四</span></label>
                                                <label><input type="checkbox" name="repeatDays" value="5"> <span>周五</span></label>
                                                <label><input type="checkbox" name="repeatDays" value="6"> <span>周六</span></label>
                                                <label><input type="checkbox" name="repeatDays" value="0"> <span>周日</span></label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" id="repeatType" name="repeatType" value="none">
                            </div>

                            <div class="form-group full-width">
                                <label for="messageContent" class="form-label">
                                    信息内容 <span class="required">*</span>
                                </label>
                                <textarea id="messageContent" name="messageContent" class="form-control" placeholder="输入信息内容" required
                                          oninput="document.getElementById('charCount').textContent = this.value.length + '/500'"></textarea>
                                <div class="char-count" id="charCount">0/500</div>
                                <div class="error-message" id="messageContentError"></div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-outline-secondary" id="resetBtn">重置</button>
                            <span class="actions-separator"></span>
                            <button type="submit" class="btn btn-primary" id="submitBtn">
                                <span class="play-icon"></span> 创建任务
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- 任务列表区域 -->
            <div class="task-list-container">
                <div class="task-list-header">
                    <div class="header-content">
                        <h2>任务列表</h2>
                        <p class="list-description">当前共有 <span id="taskCount">0</span> 个任务</p>
                    </div>
                    <div class="task-list-actions">
                        <button type="button" class="btn btn-outline-primary" id="importBtn" disabled>
                            <span class="import-icon"></span> 导入
                        </button>
                        <button type="button" class="btn btn-outline-primary" id="exportBtn" disabled>
                            <span class="export-icon"></span> 导出
                        </button>
                        <button type="button" class="btn btn-primary" id="executeBtn" disabled>
                            <span class="play-icon"></span> 开始执行
                        </button>
                    </div>
                </div>
                <!-- 改为ul元素更符合语义化要求 -->
                <ul class="task-list" id="taskList">
                    <div class="empty-task-state" id="emptyTaskState">
                        <div class="empty-state-image animate-fade-in">
                            <img src="{{ url_for('static', filename='images/empty-tasks.svg') }}" alt="暂无任务" class="empty-state-icon">
                        </div>
                        <h3 class="empty-state-title">暂无任务</h3>
                        <p class="empty-state-description">点击上方的"创建新任务"按钮，开始创建您的第一个自动信息任务</p>
                    </div>
                    <!-- 任务项将通过JavaScript动态添加 -->
                </ul>
            </div>
        </main>
    </div>
{% endblock %}
